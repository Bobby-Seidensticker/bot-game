<!DOCTYPE html>
<head>
  <title></title>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <link href="styles/main.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700" rel="stylesheet" type="text/css">
</head>

<body>
  <script id="item-slot-template" type="text/template">
    <% if (slot !== undefined) { %>
      <% if (typeof(slot) === 'number') { %>
        <div class="slot-background" draggable="false"><%= slot + 1 %></div>
      <% } else { %>
        <img class="slot-background" draggable="false" src="assets/<%= slot %>_slot.png" />
      <% } %>
    <% } %>

    <% if (model) { %>
      <img draggable=false src="assets/<%= utils.spaceToUnderscore(model.name) %>.png" />
      <div class="newflag">New!</div>
      <div class="corner corner-level"><%= model.level %></div>
      <div class="xpbar" style="width: <%= 63 * model.pctLeveled() %>px;"></div>
      <div class="overlay"></div>
    <% } else { %>
      <div class="overlay"></div>
    <% } %>
  </script>

  <script id="draggable-template" type="text/template">
    <img draggable=false src="assets/<%= namespace.bot.utils.spaceToUnderscore(name) %>.png" />
    <div class="corner corner-level"><%= level %></div>
    <div class="xpbar" style="width: <%= 63 * pctLeveled() %>px;"></div>
  </script>

  <script id="item-tab-template" type="text/template">
    <div class="holder">
      <div class="container equipped">
        <div class="header">Equipped Gear</div>
        <!--<img src="assets/gearslots.svg" style="display:block; opacity:0.4;"/>-->
      </div>

      <div class="container skillchain">
        <div class="header">Equipped Skills</div>
        <!--img src="assets/skillslots.svg" style="display:block; opacity:0.4;"/ -->      
      </div>

      <div class="container unequipped">
        <div class="filters"></div>
      </div>
    </div>
  </script>

  <script id="card-tab-template" type="text/template">
    <div class="holder">
      <div class="container equipped">
        <div class="header">Equipped Gear</div>
      </div>

      <div class="container skillchain">
        <div class="header">Equipped Skills</div>
        <!--img src="assets/skillslots.svg" style="display:block; opacity:0.4;"/ -->            
      </div>

      <div class="container equipped-cards">
        <div class="header"></div>
      </div>

      <div class="container unequipped">
        <div class="header"></div>
      </div>
    </div>
  </script>

  <script id="info-box-template" type="text/template">
    <% if (model) { %>
      <% if (model.itemType !== 'card') { %>
        <div class="titlebox"><%= namespace.bot.utils.firstCap(model.name) %></div>
        <% if (model.itemType === "armor") { %>
          <div class="infoitem"><%= namespace.bot.utils.firstCap(model.slot) %> Armor</div>
        <% } else if (model.itemType === "weapon") { %>
          <div class="infoitem"><%= namespace.bot.utils.firstCap(model.weaponType) %> Weapon</div>
        <% } else if (model.itemType === "skill") { %>
          <div class="infoitem"><%= namespace.bot.utils.firstCap(model.skillType) %> Skill</div>
        <% } %>
        <div class="infoitem">Level <%= model.level %></div>
        <div class="infoitem">XP <%= model.xp %> / <% print(model.getNextLevelXp()); %></div>
        <div class="xpbox"><div class="xpearned" style="width: <%= (model.xp / model.getNextLevelXp()) * 100 %>px"></div></div>
        <% if (model.disabled) { %>
        <div class="infoitem disabled">Skill Cannot Be Used Because Wrong Weapon Type Equipped</div>
        <% } %>
        <div class="mods">
        <% _.each(namespace.bot.utils.prettifyMods(model.baseMods, model.level), function(modstr) { %>
          <div class="mod"><%= modstr %></div>
        <% }); %>
        <div class="infoitem">Next Level: </div>
        <% _.each(namespace.bot.utils.prettifyPerLvlMods(model.baseMods), function(modstr) {%>
        <div class="perLvlMod"><%= modstr %></div>
        <% }); %>
        </div>
      <% } else { %>
        <div class="titlebox"><%= namespace.bot.utils.firstCap(model.name) %></div>
        <div class="infoitem"><%= namespace.bot.utils.firstCap(model.slot) %> Card</div>
        <div class="infoitem">Level <%= model.level %></div>
        <div class="infoitem"><%= Math.floor(model.qp) %> / <% print(model.getNextLevelQp()) %> QP</div>
        <div class="xpbox"><div class="xpearned" style="width: <%= model.qp / model.getNextLevelQp() * 100 %>px"></div></div>
        <div class="mods">
        <% _.each(namespace.bot.utils.prettifyMods(model.mods, model.level), function(modstr) {%>
          <div class="mod"><%= modstr %></div>
         <% }); %>
          <div class="infoitem">Next Level: </div>
          <% _.each(namespace.bot.utils.prettifyPerLvlMods(model.mods, model.level), function(modstr) {%>
            <div class="perLvlMod"><%= modstr %></div>
          <% }); %>
        </div>
      <% } %>
      <% if (model.flavor) { %>
        <div class="infoitem flavor"><%= model.flavor %></div>
      <% } %>
      <% if (model.itemType === 'skill' && model.equipped) { %>
        <div class="infoitem skilldmg">Total Damage: <%= model.getTotalDmg() %></div>
        <div class="infoitem skilldmg">DPS: <%= model.getDps() %></div>
        <div class="infoitem skilldmg">Range: <%= model.range %></div>
        <div class="infoitem skilldmg">Duration: <%= model.speed %>ms</div>
        <div class="infoitem skilldmg">Cooldown: <%= model.cooldownTime %>ms</div>
        <div class="infoitem skilldmg">Mana Cost: <%= Math.floor(model.manaCost*100) / 100 %></div>        
      <% } %>
    <% } %>
  </script>

  <script id="card-inventory-info-box-template" type="text/template">
    <h3><%= model.name %></h3>
    <div class="mods">
      <div>Level <%= model.level %></div>
      <% _.each(model.mods, function(mod) { %>
        <div><%= mod.def %></div>
      <% }); %>
    </div>
  </script>

  <script id="kv-table-template" type="text/template">
    <table>
    <% _.each(data, function(value, key) { %>
        <tr><th><%= utils.firstCap(key) %></th></tr>
        <% _.each(value, function(val) { %>
            <tr><td><%= val[0] %></td><td><%= val[1] %></td></tr>
        <% }); %>
    <% }); %>
    </table><table>    
    <% _.each(skilldata, function(value, key) { %>
        <tr><th><%= utils.firstCap(key) %></th></tr>
        <% _.each(value, function(val) { %>
            <tr><td><%= val[0] %></td><td><%= val[1] %></td></tr>
        <% }); %>
    <% }); %>        
    </table>
  </script>

  <script id="stat-bar-template" type="text/template">
    <div class="bar"></div>
    <div class="text"></div>
  </script>

  <script id="hero-footer-template" type="text/template">
    <table>
      <tbody>
        <tr><td>Health</td>  <td class="hp"><% print(Math.ceil(hp)) %></td>      <td>/</td> <td><%= Math.ceil(spec.maxHp) %></td></tr>
        <tr><td>Mana</td>    <td class="mana"><% print(Math.ceil(mana)) %></td>  <td>/</td> <td><%= Math.ceil(spec.maxMana) %></td></tr>
        <tr><td>Level</td>    <td class="level"><%= spec.level %></td></tr>
        <tr><td>Xp</td>    <td class="xp"><% print(Math.floor(spec.xp)) %></td>  <td>/</td> <td><% print(spec.getNextLevelXp()) %></td></tr>
      </tbody>
    </table>
  </script>

  <script id="zone-footer-template" type="text/template">
    <table>
      <tbody>
        <tr>
          <td>Zone</td><td><%= name %></td>
        </tr>
        <tr>
          <td>Level</td><td><%= level %></td>
        </tr>
        <tr>
          <td>Room</td><td><% print(heroPos + 1) %> / <% print(rooms.length) %></td>
        </tr>
        <tr>
          <td>Monsters</td><td><% print(liveMons().length) %> / <% print(ensureRoom().monsters.length) %></td>
        </tr>

      </tbody>
    </table>
  </script>

  <script id="skill-footer-template" type="text/template">
    <div class="box">
      <img src="assets/<%= utils.spaceToUnderscore(model.spec.name) %>.png" />
      <div class="cooldown"></div>
      <div class="indicator range-indicator">R</div>
      <div class="indicator mana-indicator">M</div>
    </div>
    <div class="use-holder"><div class="use-bar"></div></div>
  </script>

  <script id="potion-template" type="text/template">
    <div class="potion">
      <div class="box">
        <img src="assets/health_potion.png" />
        <div class="cooldown"></div>
      </div>
      <div class="use-holder"><div class="use-bar"></div></div>
    </div>
  </script>

  <script id="buttons-footer-template" type="text/template">
    <div class="config-button noselect">Config</div>
    <div class="stats-button noselect">Stats</div>
    <div class="inv-button noselect"><span class="invnewflag">New</span>Inv</div>
    <div class="help-button noselect">Help</div>
    <div class="map-button noselect">Map</div>
    <div class="cards-button noselect"><span class="cardnewflag">New</span>Cards</div>
  </script>

  <script id="zone-map-tab-template" type="text/template">
    <img />
    Zone Name: <%= name %><br/>
    Level: <%= level %>
  </script>
  
  <script id="map-tab-template" type="text/template">
    <div class="holder">
    </div>
  </script>

  <script id="inv-menu-item-template" type="text/template">
    <div class="item-header">
      <%= name %> - level <span class="level"></span>
    </div>
    <div class="item-body">
      <div class="item-mid">
        <img src="assets/<%= utils.spaceToUnderscore(name) %>.png" height="90" width="90">
        <div class="item-mid-text">
          Type: <%= itemType %><br/><%= midExtra %> 
        </div>
      </div>
      <div class="item-affixes">
      </div>
      <div class="item-buttonbox">
        <%= buttons %>
      </div>
    </div>
  </script>

  <script id="inv-menu-item-xp" type="text/template">
    <span class="xp">0</span> / <span class="nextLevelXp">?</span> XP
  </script>

  <script id="inv-menu-item-buttons-template" type="text/template">
    <input class="item-button level-up" value="Level Up" type="button" disabled/>
    <input class="item-button equip" value="Equip" type="button" />
  </script>

  <script id="craft-menu-item-buttons-template" type="text/template">
    <input class="item-button craft" value="Craft" type="button" disabled />
    <input class="item-button scrap" value="Scrap" type="button" />
  </script>

  <script id="inv-menu-template" type="text/template">
    <div class="inv-content">
      <% _.each(groups, function(group) { %>
      <div class="item-group <%= group %>">
        <div class="item-group-header">
          <% print(group[0].toUpperCase() + group.slice(1)) %>
        </div>
        <div class="item-group-content">
        </div>
      </div>
      <% }); %>
    </div>
  </script>

  <script id="craft-menu-template" type="text/template">
    <div class="craft-content">
      <% _.each(groups, function(group) { %>
      <div class="item-group <%= group %>">
        <div class="item-group-header">
          <% print(group[0].toUpperCase() + group.slice(1)) %>
        </div>
        <div class="item-group-content">
        </div>
      </div>
      <% }); %>
    </div>
  </script>

  <script id="lvlup-tab-template" type="text/template">
    <div class="lvlupcontent">
      <div class="lvlupitemholder">
        <div class="lvlupitemimg">
          <img src="http://img1.wikia.nocookie.net/__cb20080817200550/diablo/images/4/4f/D2-u-Treadsofcthon.gif" />
        </div>
        <div class="lvlupitemstats">
          Magic Shoes <br>
          + 5 Fire Damage<br>
          + 10 Armor<br>
        </div>
      </div>
      <div class="lvluprollbox">
        Affix on next level: <br><br>
        + 3 Fire Damage
      </div>
      <input type="button" value="Reroll" />
      <input type="button" value="Level Up" />
    </div>
  </script>

  <script id="settings-tab-template" type="text/template">
    <div class="settingscontent">
      <input type="button" value="Save" />
      <input type="button" value="Mute" />
    </div>
  </script>

  <script id="header-stats-template" type="text/template">
    <table>
      <tr>
        <td>Name</td>
        <td id="name"><%= name %></td>
      </tr>
      <tr>
        <td>Level</td>
        <td id="level"><%= level %></td>
      </tr>
      <tr>
        <td>Hp</td>
        <td id="hp"><%= hp %> / <%= maxHp %></td>
      </tr>
      <tr>
        <td>Mana</td>
        <td id="mana"><%= mana %> / <%= maxMana %></td>
      </tr>
      <tr>
        <td>Xp</td>
        <td id="xp"><%= xp %> / <%= nextLevelXp %></td>
      </tr>
    </table>
  </script>

  <script id="header-zone-stats-template" type="text/template">
    <table>
      <tr>
        <td>Zone</td>
        <td id="name"><%= name %></td>
      </tr>
      <tr>
        <td>Level</td>
        <td id="level"><%= level %></td>
      </tr>
      <tr>
        <td>Room</td>
        <td id="room"><%= heroPos + 1 %> / <%= roomCount %></td>
      </tr>
      <tr>
        <td>Monsters</td>
        <td id="monsters"><%= livingCount %> / <%= totalCount %></td>
      </tr>
    </table>
  </script>

  <script id="header-equipped-template" type="text/template">
    <% _.each(items, function(item, slot) { %>
    <div class="<%= slot %>">
      <img class="slot-background" src="assets/<%= 'empty-' + slot %>.svg" width="60" height="60" />
      <% if (item) { %>
      <img class="slot-img" src="assets/<%= item.get('name') %>.png" width="60" height="60" />
      <% } else { %>
      <img class="empty slot-img" width="60" height="60" />
      <% } %>
    </div>
    <% }); %>
  </script>

  <script id="header-skillchain-template" type="text/template">
    <% _.each([0, 1, 2, 3, 4, 5], function(i) { %>
    <div class="skill-slot <%= i %>"></div>
    <% }); %>
  </script>

  <script id="header-skill-template" type="text/template">
    <div class="veil"></div>
    <div class="img-holder">
      <img src="assets/<%= name %>.svg" />
    </div>
  </script>

  <script id="config-template" type="text/template">
    <div><p>What is your name?</p>
      <input id="charname" type="text" value="<%= gl.game.hero.name %>" /><input type="button" value="OK" id="namebutton" />
      <p>Message to the devs?</p>
      <textarea id="devmsg" placeholder="Thanks for your feedback!" rows="5" cols="20" wrap="soft"/>
      <input type="button" value="OK" id="devbutton" />
      <p>Donate to development of our game!</p>
      <p>Enter an amount in USD (min $1)</p>
      <input type="text" value="10.00" id="donationamount" />
      <button id="donateButton">Donate (via Stripe)</button>
      <p style="width:90%">All donations will be rolled forward into our in-game paid currency system once implemented (donate $10, get $10 of in-game currency later based on email address used to donate)</p>
      <p>Wipe your game data and reset?</p>
      <input type="button" value="WIPE SAVE AND RELOAD" id="wipebutton" />
      <p>(no prestige bonuses - coming soon)</p>
      <p><input type="checkbox" id="enableBuildHotkeys">Enable Save/Load builds with 0-9</p>
      <p>When enabled, press Shift+0-9 to save build</p>
      <p>Once saved, press 0-9 to load build</p>
    </div>
  </script>

  <script id="help-template" type="text/template">
    <div>
      <h4>Welcome to Dungeons of Derp</h4>

      <p>Version<%= gl.VERSION_NUMBER %></p>
      <p>Hints:</p>
      <p>-Click your potion to regain some health</p>
      <p>-Click "Inv" or "Card" buttons to change equipment</p>
      <p>-Click the Config button to change your name</p>     

        <p>Please check out our <a href="https://www.reddit.com/r/DungeonsOfDerp" target="_blank">Subreddit</a> for more help</p>
      
        <p>We have been focused on engine, UI and balance, and haven't made an in-game tutorial yet.  Please feel free to give the game a try without reading all of this, but not all of our controls are completely intuitive, so please read through this if you get stuck.The game has only been balanced up to about level 20 so far - if you beat the Gothic Castle, you've "won".</p>

        <p>Getting started:</p>
        <p>You're going to be dying a lot at the beginning, don't worry about it.</p>

        <p>To start being able to survive in the first zone, "Spooky Dungeon", you'll need to get a full set of armor, equip some cards, and maybe find a better skill.</p>

        <p>Equipping gear:</p>
        <p>Click the Inv button in the footer to open the Inventory Tab.</p>

        <p>The first row of slots is your equipped gear.  You start with only a helmet and sword equipped.</p>

        <p>The second row of slots is your "Skillchain" - up to five skills which you character will try to use in left-to-right order whenever they can take another action.</p>

        <p>Below this is your inventory- which contains all of your unequipped items.  Hovering over items in your inventory will highlight valid slots in which they can be placed.</p>

        <p>To equip an item or skill, click the unequipped item to select it.  This will make a yellow border around it.  Then click the slot in which you'd like it to be placed.</p>

        <p>Understanding the Skillchain</p>
        <p>The skillchain is the way in which you control your hero's behavior and which skills they will use when.</p>

        <p>Whenever a character is free to use a new action, each skill is checked from left to right to see if it can be used: if the character has enough mana, the skill isn't on cooldown, and an enemy is within range.  If all of these criteria are met, the skill is used.  Otherwise, the next skill is checked.  If no skills can be used, a character will try to move closer to get in range.</p>

        <p>Equipping Cards</p>
        <p>Now that we have a basic understanding of the Inv Tab, lets switch over to the Card Tab to equip some cards.  Click the “Card” button in the footer.</p>

        <p>Each item equipped on the Inv Tab has 5 Card slots. These cards can make items or skills stronger and grant powerful bonuses.  By stacking multiple similar cards together, you can get even better results.</p>

        <p>In the default view, you'll see all of your items and all of your unequipped cards.  You can hover over cards to see more information about them and highlight valid items or skills they could be placed into.</p>

        <p>First, select an item you'd like to put a card into by clicking on it.  This will add a yellow border to the item and filter the unequipped cards to only those which could be placed inside the item. Now, you can click on a unequipped card to select it, and then click on a slot to place it there.  Sorry we know this is kind of janky, and will implement drag and drop soonish. If you have UI suggestions we'd love to hear them.  You can send us messages through our subreddit or in-game inside the Config tab.</p>

        <p>Beating the First Level:</p>
        <p>There are several ways to beat the first zone and kill the skeleton king, but these tips will probably help you a lot:</p>
        <p>Use your Potion!</p>
        <p>Heart juice is the first method you get of regenerating health, and is essential to having enough health to fight the boss.  Skeleton mages drop heart juice, so make sure you character can kill them effectively.</p>
        <p>Equip all of the cards you can!  There aren't any cards in the first zone which have negatives to you hero, so you should equip all the cards you find.  As your slots get full and stranger cards drop, you'll have to be more discriminating.</p>
        <p>Bosses are hard!  You might have better luck leveling up in a harder zone and coming back to kill the skeleton king.</p>
  </div>
  </script>
  
  <script type="text/template" id="menu-tab-template">
    <td class="tab" id="<%- name %>"><%- name %></td>
  </script>

  <!-- Libs -->
  <script type="text/javascript" src="scripts/sugar.js"></script>

  <script type="text/javascript" src="scripts/libs/raf-shim.js"></script>
  <script type="text/javascript" src="scripts/libs/jquery.min.js"></script>
  <script type="text/javascript" src="scripts/libs/namespace-plus.js"></script>
  <script type="text/javascript" src="scripts/libs/sprintf.min.js"></script>
  <script type="text/javascript" src="scripts/libs/underscore.js"></script>
  <script type="text/javascript" src="scripts/libs/backbone.js"></script>
  <script type="text/javascript" src="scripts/backbone-mods.js"></script>
  <script type="text/javascript" src="scripts/libs/backbone.localStorage.js"></script>
  <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
  <script src="https://checkout.stripe.com/checkout.js"></script>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60405705-1', 'auto');
    ga('send', 'pageview');
  </script>
  
  <!-- Our files -->
  <script type="text/javascript" src="scripts/log.js"></script>
  <script type="text/javascript" src="scripts/prob.js"></script>
  <script type="text/javascript" src="scripts/itemref.js"></script>
  <script type="text/javascript" src="scripts/events.js"></script>

  <script type="text/javascript" src="scripts/utils.js"></script>

  <script type="text/javascript" src="scripts/bodies.js"></script>
  <script type="text/javascript" src="scripts/damage.js"></script>
  <script type="text/javascript" src="scripts/drops.js"></script>
  <script type="text/javascript" src="scripts/inventory.js"></script>
  <script type="text/javascript" src="scripts/entity.js"></script>
  <script type="text/javascript" src="scripts/attacks.js"></script>
  <script type="text/javascript" src="scripts/zone.js"></script>
  <script type="text/javascript" src="scripts/vis.js"></script>
  <script type="text/javascript" src="scripts/views.js"></script>
  <script type="text/javascript" src="scripts/main.js"></script>

  <!-- Entry point -->
  <script>
    $(namespace.bot.main.onReady);
  </script>

</body>
